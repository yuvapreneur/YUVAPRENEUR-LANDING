<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Caf√© Business Masterclass</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .fade-in-up {
      animation: fadeInUp 0.8s ease-out;
    }
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body class="min-h-screen bg-white text-gray-900 p-4">
  <!-- Navigation -->
  <nav class="bg-white shadow-lg p-4 mb-8 rounded-xl border border-gray-200">
    <div class="max-w-7xl mx-auto flex justify-between items-center">
      <div class="text-2xl font-bold text-purple-600">‚òï Caf√© Business Masterclass</div>
             <div class="space-x-4" id="navigationLinks">
         <a href="index.html" class="text-gray-600 hover:text-purple-600 transition-colors">Home</a>
         <a href="bonuses.html" class="text-gray-600 hover:text-purple-600 transition-colors">Bonuses</a>
         <a href="buy.html" class="text-gray-600 hover:text-purple-600 transition-colors">Buy Course</a>
         <a href="login.html" class="text-gray-600 hover:text-purple-600 transition-colors hidden" id="loginLink">Login</a>
         <button onclick="logout()" class="text-red-600 hover:text-red-700 transition-colors font-medium">üö™ Logout</button>
       </div>
    </div>
  </nav>

     <!-- User Profile Section -->
   <div class="max-w-4xl mx-auto mb-8 fade-in-up">
     <div class="bg-white shadow-lg p-6 border border-gray-200 rounded-xl">
       <h2 class="text-2xl font-bold text-gray-900 mb-4">üë§ User Profile</h2>
       <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
         <div>
           <label class="block text-gray-700 text-sm font-medium mb-2">Username</label>
           <div class="text-gray-900" id="username">Loading...</div>
         </div>
         <div>
           <label class="block text-gray-700 text-sm font-medium mb-2">Email</label>
           <div class="text-gray-900" id="email">Loading...</div>
         </div>
         <div>
           <label class="block text-gray-700 text-sm font-medium mb-2">Course Status</label>
           <div class="text-purple-600" id="courseStatus">Loading...</div>
         </div>
         <div>
           <label class="block text-gray-700 text-sm font-medium mb-2">Bonuses Access</label>
           <div class="text-purple-600" id="bonusCount">Loading...</div>
         </div>
       </div>
       
       <!-- Debug Section (only visible if there are issues) -->
       <div class="mt-6 pt-4 border-t border-gray-200" id="debugSection" style="display: none;">
         <h3 class="text-lg font-semibold text-gray-900 mb-3">üîß Troubleshooting</h3>
         <div class="bg-gray-50 p-4 rounded-lg">
           <p class="text-sm text-gray-600 mb-3">If you're having access issues, try these solutions:</p>
           <div class="space-y-2">
             <button onclick="grantManualAccess()" class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm transition-colors">
               ‚úÖ I Have Already Paid - Grant Access
             </button>
             <button onclick="clearEnrollmentData()" class="w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded text-sm transition-colors">
               üóëÔ∏è Clear All Data & Start Fresh
             </button>
             <button onclick="showEnrollmentData()" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm transition-colors">
               üìä Show Current Enrollment Data
             </button>
           </div>
         </div>
       </div>
     </div>
   </div>

  <!-- Course Access Section -->
  <div class="max-w-4xl mx-auto mb-8 fade-in-up" id="courseAccess">
    <!-- Course access status will be populated by JavaScript -->
  </div>

  <!-- Course Modules Section -->
  <div class="max-w-6xl mx-auto mb-8 fade-in-up">
    <h2 class="text-2xl font-bold text-gray-900 text-center mb-6">üìö Course Modules</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="modulesGrid">
      <!-- Modules will be populated by JavaScript -->
    </div>
  </div>

  <!-- Bonuses Section -->
  <div class="max-w-6xl mx-auto mb-8 fade-in-up">
    <h2 class="text-2xl font-bold text-gray-900 text-center mb-6">üéÅ Your Bonuses</h2>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="bonusesGrid">
      <!-- Bonuses will be populated by JavaScript -->
    </div>
  </div>

  <script>
         // Course modules data
     const MODULES = [
       {
         number: 1,
         title: "Introduction to Caf√© Business",
         desc: "Complete foundation and overview of starting a caf√© business",
         icon: "‚òï",
         filename: "Module1 (2).pdf"
       },
       {
         number: 2,
         title: "Market Research & Location Analysis",
         desc: "Learn to identify profitable locations and understand your target market",
         icon: "üîç",
         filename: "Module 2  (1).pdf"
       },
       {
         number: 3,
         title: "Business Plan & Financial Planning",
         desc: "Create a solid business plan and financial projections",
         icon: "üìä",
         filename: "Module 3  (1).pdf"
       },
       {
         number: 4,
         title: "Legal Requirements & Licenses",
         desc: "Navigate legal requirements and obtain necessary licenses",
         icon: "‚öñÔ∏è",
         filename: "Module 4  (2).pdf"
       },
       {
         number: 5,
         title: "Kitchen Design & Equipment",
         desc: "Design efficient kitchen layouts and choose right equipment",
         icon: "üç≥",
         filename: "Module 5  (3).pdf"
       },
       {
         number: 6,
         title: "Menu Planning & Pricing Strategy",
         desc: "Create profitable menus and implement smart pricing",
         icon: "üìã",
         filename: "Module 6  (1).pdf"
       },
       {
         number: 7,
         title: "Staff Hiring & Management",
         desc: "Build and manage a high-performing team",
         icon: "üë•",
         filename: "Module 7  (2).pdf"
       },
       {
         number: 8,
         title: "Marketing & Branding",
         desc: "Develop strong brand identity and marketing strategies",
         icon: "üéØ",
         filename: "Module 8  (1).pdf"
       },
       {
         number: 9,
         title: "Customer Service Excellence",
         desc: "Deliver exceptional customer experiences",
         icon: "‚≠ê",
         filename: "Module 9  (2).pdf"
       },
       {
         number: 10,
         title: "Operations & Quality Control",
         desc: "Streamline operations and maintain quality standards",
         icon: "‚öôÔ∏è",
         filename: "Module 10  (3).pdf"
       },
       {
         number: 11,
         title: "Financial Management & Accounting",
         desc: "Manage finances, track expenses, and maximize profits",
         icon: "üí∞",
         filename: "Module 11 (4).pdf"
       },
       {
         number: 12,
         title: "Growth & Expansion Strategies",
         desc: "Scale your business and explore new opportunities",
         icon: "üöÄ",
         filename: "Module 12 (4).pdf"
       }
     ];

    // Bonus data
    const BONUSES = [
      { sku: "bonus-menu-psych", title: "Caf√© Menu Psychology Blueprint", desc: "Design menus that increase average order value and customer satisfaction." },
      { sku: "bonus-festival", title: "Festival & Seasonal Marketing Guide", desc: "Ready-to-use ideas & creatives to boost festive sales." },
      { sku: "bonus-loyalty", title: "How to Create a Caf√© Loyalty Program", desc: "Step-by-step template for a loyalty program that brings repeat customers." },
      { sku: "bonus-photo", title: "Photography Cheat Sheet", desc: "Quick setups for mouth-watering food & caf√© photos (phone ready)." }
    ];

    // Load user profile
    function loadUserProfile() {
      // Check if user is enrolled
      const enrollmentData = localStorage.getItem('userEnrollment');
      
      if (enrollmentData) {
        try {
          const userData = JSON.parse(enrollmentData);
          
          // Show enrolled user data
          document.getElementById('username').textContent = userData.name || 'Enrolled User';
          document.getElementById('email').textContent = userData.email || 'user@example.com';
          
          if (userData.status === 'enrolled' && userData.courseAccess === 'full') {
            document.getElementById('courseStatus').textContent = '‚úÖ Fully Enrolled';
            document.getElementById('bonusCount').textContent = '4 (All Bonuses Included)';
            
            // Update course access to show enrolled status
            updateCourseAccessForEnrolledUser();
          } else if (userData.status === 'pending_payment') {
            document.getElementById('courseStatus').textContent = '‚è≥ Payment Pending';
            document.getElementById('bonusCount').textContent = '0 (Complete Payment Required)';
            loadCourseAccess();
          } else {
            document.getElementById('courseStatus').textContent = '‚ùå Payment Failed';
            document.getElementById('bonusCount').textContent = '0 (Payment Required)';
            loadCourseAccess();
          }
          
        } catch (error) {
          console.error('Error loading enrollment data:', error);
          loadDefaultProfile();
        }
      } else {
        loadDefaultProfile();
      }
    }
    
         // Load default profile for non-enrolled users
     function loadDefaultProfile() {
       document.getElementById('username').textContent = 'abhijjetwankhede';
       document.getElementById('email').textContent = 'yuvapreneur@gmail.com';
       document.getElementById('courseStatus').textContent = '‚ùå Not Enrolled';
       document.getElementById('bonusCount').textContent = '0';
     }
    
    // Update course access for enrolled users
    function updateCourseAccessForEnrolledUser() {
      const courseAccessDiv = document.getElementById('courseAccess');
      courseAccessDiv.innerHTML = `
        <div class="bg-white shadow-lg p-6 border border-gray-200 rounded-xl">
          <div class="bg-green-50 border border-green-200 rounded-lg p-4">
            <h3 class="text-lg font-semibold text-green-800 mb-2">üéâ Course Access Granted!</h3>
            <p class="text-green-700 mb-4">Welcome to the Caf√© Business Masterclass! You now have access to all 12 modules and 4 exclusive bonuses.</p>
            <div class="text-center mt-6">
              <a href="#modules" class="inline-block bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg text-lg font-semibold transition-colors transform hover:scale-105">
                üìö Start Learning
              </a>
            </div>
          </div>
        </div>
      `;
    }

    // Load course access status
    function loadCourseAccess() {
      const courseAccessDiv = document.getElementById('courseAccess');
      const enrollmentData = localStorage.getItem('userEnrollment');
      
      if (enrollmentData) {
        try {
          const userData = JSON.parse(enrollmentData);
          
          if (userData.status === 'pending_payment') {
            // Show payment pending status
            courseAccessDiv.innerHTML = `
              <div class="bg-white shadow-lg p-6 border border-gray-200 rounded-xl">
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                  <h3 class="text-lg font-semibold text-yellow-800 mb-2">‚è≥ Payment Pending</h3>
                  <p class="text-yellow-700 mb-4">Your enrollment is pending. Please complete the payment to get full course access.</p>
                  <div class="text-center mt-6">
                    <a href="index.html" class="inline-block bg-yellow-600 hover:bg-yellow-700 text-white px-6 py-3 rounded-lg text-lg font-semibold transition-colors transform hover:scale-105">
                      üí≥ Complete Payment
                    </a>
                  </div>
                </div>
              </div>
            `;
          } else if (userData.status === 'payment_failed') {
            // Show payment failed status with direct retry option
            courseAccessDiv.innerHTML = `
              <div class="bg-white shadow-lg p-6 border border-gray-200 rounded-xl">
                <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                  <h3 class="text-lg font-semibold text-red-800 mb-2">‚ùå Payment Failed</h3>
                  <p class="text-red-700 mb-4">Your payment was not successful. Please try again to get course access.</p>
                  <div class="text-center mt-6 space-y-3">
                    <button onclick="retryPayment()" class="inline-block bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg text-lg font-semibold transition-colors transform hover:scale-105">
                      üîÑ Retry Payment Now
                    </button>
                    <div class="text-sm text-red-600">or</div>
                    <button onclick="grantManualAccess()" class="inline-block bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg text-lg font-semibold transition-colors transform hover:scale-105">
                      ‚úÖ I Have Already Paid - Grant Access
                    </button>
                    <div class="text-sm text-red-600">or</div>
                    <a href="index.html" class="inline-block bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg text-lg font-semibold transition-colors transform hover:scale-105">
                      üìù Re-enroll with New Details
                    </a>
                  </div>
                </div>
              </div>
            `;
          } else {
            // Show not enrolled status
            courseAccessDiv.innerHTML = `
              <div class="bg-white shadow-lg p-6 border border-gray-200 rounded-xl">
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                  <h3 class="text-lg font-semibold text-purple-800 mb-2">‚ö†Ô∏è Course Not Enrolled</h3>
                  <p class="text-purple-700 mb-4">You need to enroll to access all 12 course modules and 4 exclusive bonuses.</p>
                  <div class="text-center mt-6">
                    <a href="index.html" class="inline-block bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg text-lg font-semibold transition-colors transform hover:scale-105">
                      üöÄ Enroll Now
                    </a>
                  </div>
                </div>
              </div>
            `;
          }
        } catch (error) {
          console.error('Error loading course access:', error);
          // Show default not enrolled status
          courseAccessDiv.innerHTML = `
            <div class="bg-white shadow-lg p-6 border border-gray-200 rounded-xl">
              <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                <h3 class="text-lg font-semibold text-purple-800 mb-2">‚ö†Ô∏è Course Not Enrolled</h3>
                <p class="text-purple-700 mb-4">You need to enroll to access all 12 course modules and 4 exclusive bonuses.</p>
                <div class="text-center mt-6">
                  <a href="index.html" class="inline-block bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg text-lg font-semibold transition-colors transform hover:scale-105">
                    üöÄ Enroll Now
                  </a>
                </div>
              </div>
            </div>
          `;
        }
      } else {
        // Show not enrolled status
        courseAccessDiv.innerHTML = `
          <div class="bg-white shadow-lg p-6 border border-gray-200 rounded-xl">
            <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
              <h3 class="text-lg font-semibold text-purple-800 mb-2">‚ö†Ô∏è Course Not Enrolled</h3>
              <p class="text-purple-700 mb-4">You need to enroll to access all 12 course modules and 4 exclusive bonuses.</p>
              <div class="text-center mt-6">
                <a href="index.html" class="inline-block bg-purple-600 hover:bg-purple-700 text-white px-6 py-3 rounded-lg text-lg font-semibold transition-colors transform hover:scale-105">
                  üöÄ Enroll Now
                </a>
              </div>
            </div>
          </div>
        `;
      }
    }

         // Load course modules
     function loadCourseModules() {
       const modulesGrid = document.getElementById('modulesGrid');
       const enrollmentData = localStorage.getItem('userEnrollment');
       
       // Check if user is fully enrolled
       const isFullyEnrolled = enrollmentData && (() => {
         try {
           const userData = JSON.parse(enrollmentData);
           return userData.status === 'enrolled' && userData.courseAccess === 'full';
         } catch (error) {
           return false;
         }
       })();
       
       MODULES.forEach(module => {
         const moduleCard = document.createElement('div');
         moduleCard.className = 'bg-white shadow-lg p-4 border border-gray-200 rounded-xl';
         
         if (isFullyEnrolled) {
           // Show unlocked modules with download option for enrolled users
           moduleCard.innerHTML = `
             <div class="flex items-center justify-between mb-3">
               <div class="text-3xl">${module.icon}</div>
               <div class="bg-green-600 text-white text-sm font-bold px-3 py-1 rounded-full">Module ${module.number}</div>
             </div>
             <h3 class="text-lg font-semibold text-gray-900 mb-2">${module.title}</h3>
             <p class="text-gray-600 text-sm mb-4">${module.desc}</p>
             <div class="text-center space-y-2">
               <div class="text-xs text-green-600">‚úÖ Unlocked - Full Access</div>
               <a href="download.html?file=${encodeURIComponent(module.filename)}&title=${encodeURIComponent(module.title)}" 
                  class="inline-block bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm transition-colors w-full text-center">
                 üì• Download Module ${module.number}
               </a>
             </div>
           `;
         } else {
           // Show locked modules for non-enrolled users
           moduleCard.innerHTML = `
             <div class="flex items-center justify-between mb-3">
               <div class="text-3xl">${module.icon}</div>
               <div class="bg-purple-600 text-white text-sm font-bold px-3 py-1 rounded-full">Module ${module.number}</div>
             </div>
             <h3 class="text-lg font-semibold text-gray-900 mb-2">${module.title}</h3>
             <p class="text-gray-600 text-sm mb-4">${module.desc}</p>
             <div class="text-center">
               <button class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded text-sm transition-colors w-full">
                 üîí Enroll to Unlock
               </button>
             </div>
           `;
         }
         
         modulesGrid.appendChild(moduleCard);
       });
     }

    // Load user bonuses
    function loadUserBonuses() {
      const bonusesGrid = document.getElementById('bonusesGrid');
      const enrollmentData = localStorage.getItem('userEnrollment');
      
      // Check if user is fully enrolled
      const isFullyEnrolled = enrollmentData && (() => {
        try {
          const userData = JSON.parse(enrollmentData);
          return userData.status === 'enrolled' && userData.courseAccess === 'full';
        } catch (error) {
          return false;
        }
      })();
      
      if (isFullyEnrolled) {
        // Show all bonuses as accessible for enrolled users
        bonusesGrid.innerHTML = `
          <div class="bonus-card bg-white shadow-lg p-6 border border-gray-200 rounded-xl">
            <div class="text-2xl mb-4">üéÅ</div>
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Caf√© Menu Psychology Blueprint</h3>
            <p class="text-gray-600 text-sm mb-4">Design menus that increase average order value and customer satisfaction.</p>
            <div class="space-y-2">
              <div class="text-xs text-green-600">‚úÖ Included with Enrollment</div>
              <a href="download.html?file=bonus-menu-psych.pdf&title=Caf√© Menu Psychology Blueprint" class="inline-block bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded text-sm transition-colors w-full text-center">
                üì• Download Bonus
              </a>
            </div>
          </div>
          
          <div class="bonus-card bg-white shadow-lg p-6 border border-gray-200 rounded-xl">
            <div class="text-2xl mb-4">üéÅ</div>
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Festival & Seasonal Marketing Guide</h3>
            <p class="text-gray-600 text-sm mb-4">Ready-to-use ideas & creatives to boost festive sales.</p>
            <div class="space-y-2">
              <div class="text-xs text-green-600">‚úÖ Included with Enrollment</div>
              <a href="download.html?file=bonus-festival.pdf&title=Festival & Seasonal Marketing Guide" class="inline-block bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded text-sm transition-colors w-full text-center">
                üì• Download Bonus
              </a>
            </div>
          </div>
          
          <div class="bonus-card bg-white shadow-lg p-6 border border-gray-200 rounded-xl">
            <div class="text-2xl mb-4">üéÅ</div>
            <h3 class="text-lg font-semibold text-gray-900 mb-2">How to Create a Caf√© Loyalty Program</h3>
            <p class="text-gray-600 text-sm mb-4">Step-by-step template for a loyalty program that brings repeat customers.</p>
            <div class="space-y-2">
              <div class="text-xs text-green-600">‚úÖ Included with Enrollment</div>
              <a href="download.html?file=bonus-loyalty.pdf&title=How to Create a Caf√© Loyalty Program" class="inline-block bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded text-sm transition-colors w-full text-center">
                üì• Download Bonus
              </a>
            </div>
          </div>
          
          <div class="bonus-card bg-white shadow-lg p-6 border border-gray-200 rounded-xl">
            <div class="text-2xl mb-4">üéÅ</div>
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Photography Cheat Sheet</h3>
            <p class="text-gray-600 text-sm mb-4">Quick setups for mouth-watering food & caf√© photos (phone ready).</p>
            <div class="space-y-2">
              <div class="text-xs text-green-600">‚úÖ Included with Enrollment</div>
              <a href="download.html?file=bonus-photo.pdf&title=Photography Cheat Sheet" class="inline-block bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded text-sm transition-colors w-full text-center">
                üì• Download Bonus
              </a>
            </div>
          </div>
        `;
      } else {
        // Show locked bonuses for non-enrolled users
        bonusesGrid.innerHTML = `
          <div class="bonus-card bg-white shadow-lg p-6 border border-gray-200 rounded-xl">
            <div class="text-2xl mb-4">üéÅ</div>
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Caf√© Menu Psychology Blueprint</h3>
            <p class="text-gray-600 text-sm mb-4">Design menus that increase average order value and customer satisfaction.</p>
            <div class="space-y-2">
              <div class="text-xs text-purple-600">üîí Enroll to Access</div>
              <a href="index.html" class="inline-block bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded text-sm transition-colors w-full text-center">
                üöÄ Enroll Now
              </a>
            </div>
          </div>
          
          <div class="bonus-card bg-white shadow-lg p-6 border border-gray-200 rounded-xl">
            <div class="text-2xl mb-4">üéÅ</div>
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Festival & Seasonal Marketing Guide</h3>
            <p class="text-gray-600 text-sm mb-4">Ready-to-use ideas & creatives to boost festive sales.</p>
            <div class="space-y-2">
              <div class="text-xs text-purple-600">üîí Enroll to Access</div>
              <a href="index.html" class="inline-block bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded text-sm transition-colors w-full text-center">
                üöÄ Enroll Now
              </a>
            </div>
          </div>
          
          <div class="bonus-card bg-white shadow-lg p-6 border border-gray-200 rounded-xl">
            <div class="text-2xl mb-4">üéÅ</div>
            <h3 class="text-lg font-semibold text-gray-900 mb-2">How to Create a Caf√© Loyalty Program</h3>
            <p class="text-gray-600 text-sm mb-4">Step-by-step template for a loyalty program that brings repeat customers.</p>
            <div class="space-y-2">
              <div class="text-xs text-purple-600">üîí Enroll to Access</div>
              <a href="index.html" class="inline-block bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded text-sm transition-colors w-full text-center">
                üöÄ Enroll Now
              </a>
            </div>
          </div>
          
          <div class="bonus-card bg-white shadow-lg p-6 border border-gray-200 rounded-xl">
            <div class="text-2xl mb-4">üéÅ</div>
            <h3 class="text-lg font-semibold text-gray-900 mb-2">Photography Cheat Sheet</h3>
            <p class="text-gray-600 text-sm mb-4">Quick setups for mouth-watering food & caf√© photos (phone ready).</p>
            <div class="space-y-2">
              <div class="text-xs text-purple-600">üîí Enroll to Access</div>
              <a href="index.html" class="inline-block bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded text-sm transition-colors w-full text-center">
                üöÄ Enroll Now
              </a>
            </div>
          </div>
        `;
      }
    }

         // Initialize dashboard
     document.addEventListener('DOMContentLoaded', function() {
       // Security check - verify user has valid access
       if (!verifyDashboardAccess()) {
         return; // Stop initialization if access denied
       }
       
       // Initialize session timeout (30 minutes of inactivity)
       initSessionTimeout();
       
       checkAndFixEnrollmentStatus(); // Check and fix enrollment status first
       loadUserProfile();
       loadCourseAccess();
       loadCourseModules();
       loadUserBonuses();
       checkEnrollmentStatus();
     });
     
     // Session timeout management
     let sessionTimeout;
     let lastActivity = Date.now();
     
     function initSessionTimeout() {
       // Reset timeout on any user activity
       const resetTimeout = () => {
         lastActivity = Date.now();
         clearTimeout(sessionTimeout);
         sessionTimeout = setTimeout(checkSessionTimeout, 30 * 60 * 1000); // 30 minutes
       };
       
       // Listen for user activity
       ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart', 'click'].forEach(event => {
         document.addEventListener(event, resetTimeout, true);
       });
       
       // Start initial timeout
       resetTimeout();
     }
     
     function checkSessionTimeout() {
       const timeSinceLastActivity = Date.now() - lastActivity;
       
       if (timeSinceLastActivity >= 30 * 60 * 1000) { // 30 minutes
         alert('‚è∞ Session Timeout\n\nYou have been inactive for 30 minutes.\n\nFor security, you will be logged out automatically.');
         logout();
       }
     }
     
     // Verify dashboard access - security check with enhanced protection
     function verifyDashboardAccess() {
       // ‚úÖ SECURITY CHECK 1: Verify authentication tokens
       const isAuthenticated = localStorage.getItem('userAuthenticated');
       const loginTimestamp = localStorage.getItem('loginTimestamp');
       const sessionToken = localStorage.getItem('sessionToken');
       
       if (!isAuthenticated || !loginTimestamp || !sessionToken) {
         showAccessDenied('‚ùå Access Denied\n\nYou must login first to access the dashboard.\n\nRedirecting to login page...');
         setTimeout(() => {
           window.location.href = 'login.html';
         }, 3000);
         return false;
       }
       
       // ‚úÖ SECURITY CHECK 2: Verify session token validity
       try {
         const decodedToken = atob(sessionToken);
         if (!decodedToken.includes('yuvapreneur@gmail.com')) {
           showAccessDenied('‚ùå Invalid Session\n\nSession token verification failed.\n\nPlease login again.\n\nRedirecting to login page...');
           setTimeout(() => {
             window.location.href = 'login.html';
           }, 3000);
           return false;
         }
       } catch (error) {
         showAccessDenied('‚ùå Session Corrupted\n\nSession data is invalid.\n\nPlease login again.\n\nRedirecting to login page...');
         setTimeout(() => {
           window.location.href = 'login.html';
         }, 3000);
         return false;
       }
       
       // ‚úÖ SECURITY CHECK 3: Check session expiry (24 hours)
       const loginTime = parseInt(loginTimestamp);
       const currentTime = Date.now();
       const sessionExpiry = 24 * 60 * 60 * 1000; // 24 hours
       
       if (currentTime - loginTime > sessionExpiry) {
         // Session expired, clear all data and redirect to login
         clearAllSessionData();
         
         showAccessDenied('‚è∞ Session Expired\n\nYour login session has expired.\n\nPlease login again to continue.\n\nRedirecting to login page...');
         setTimeout(() => {
           window.location.href = 'login.html';
         }, 3000);
         return false;
       }
       
       // ‚úÖ SECURITY CHECK 4: Verify user enrollment data exists
       const enrollmentData = localStorage.getItem('userEnrollment');
       
       if (!enrollmentData) {
         showAccessDenied('‚ùå Access Denied\n\nYou must purchase the course first to access the dashboard.\n\nRedirecting to home page...');
         setTimeout(() => {
           window.location.href = 'index.html';
         }, 3000);
         return false;
       }
       
       try {
         const userData = JSON.parse(enrollmentData);
         
         // ‚úÖ SECURITY CHECK 5: Verify course purchase
         if (!userData.hasPurchasedCourse) {
           showAccessDenied('‚ùå Course Purchase Required\n\nYou must purchase the course first to access the dashboard.\n\nRedirecting to home page...');
           setTimeout(() => {
             window.location.href = 'index.html';
           }, 3000);
           return false;
         }
         
         // ‚úÖ SECURITY CHECK 6: Check enrollment status
         if (userData.status !== 'enrolled' || userData.courseAccess !== 'full') {
           showAccessDenied('‚ùå Payment Required\n\nYour course enrollment is incomplete.\n\nStatus: ' + (userData.status || 'Not enrolled') + '\n\nRedirecting to home page...');
           setTimeout(() => {
             window.location.href = 'index.html';
           }, 3000);
           return false;
         }
         
         // ‚úÖ SECURITY CHECK 7: Verify payment details exist
         if (!userData.paymentId && !userData.manualAccessGranted) {
           showAccessDenied('‚ùå Payment Verification Failed\n\nNo payment record found for your enrollment.\n\nRedirecting to home page...');
           setTimeout(() => {
             window.location.href = 'index.html';
           }, 3000);
           return false;
         }
         
         // ‚úÖ SECURITY CHECK 8: Update last activity
         localStorage.setItem('lastActivity', currentTime.toString());
         
         // All security checks passed
         return true;
         
       } catch (error) {
         console.error('Dashboard access verification error:', error);
         showAccessDenied('‚ùå System Error\n\nAn error occurred during access verification.\n\nRedirecting to home page...');
         setTimeout(() => {
           window.location.href = 'index.html';
         }, 3000);
         return false;
       }
     }
     
     // Clear all session data for security
     function clearAllSessionData() {
       localStorage.removeItem('userEnrollment');
       localStorage.removeItem('tempUserData');
       localStorage.removeItem('purchasedBonuses');
       localStorage.removeItem('userAuthenticated');
       localStorage.removeItem('loginTimestamp');
       localStorage.removeItem('sessionToken');
       localStorage.removeItem('lastActivity');
     }
     
     // Show access denied message
     function showAccessDenied(message) {
       // Clear dashboard content
       document.body.innerHTML = `
         <div class="min-h-screen bg-red-50 flex items-center justify-center p-4">
           <div class="max-w-md mx-auto text-center">
             <div class="bg-white shadow-lg p-8 border border-red-200 rounded-xl">
               <div class="text-6xl mb-4">üö´</div>
               <h1 class="text-2xl font-bold text-red-800 mb-4">Access Denied</h1>
               <p class="text-red-700 mb-6">${message}</p>
               <div class="space-y-3">
                 <a href="index.html" class="block w-full bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                   üè† Go to Home Page
                 </a>
                 <a href="login.html" class="block w-full bg-gray-600 hover:bg-gray-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors">
                   üîê Try Login Again
                 </a>
               </div>
             </div>
           </div>
         </div>
       `;
     }
     
     // Logout function with enhanced security
     function logout() {
       const confirmLogout = confirm('üö™ Logout\n\nAre you sure you want to logout?\n\nYou will need to login again to access the dashboard.');
       
       if (confirmLogout) {
         // ‚úÖ SECURITY: Clear all session and authentication data
         clearAllSessionData();
         
         // Show logout message
         alert('‚úÖ Logged out successfully!\n\nAll session data cleared for security.\n\nRedirecting to home page...');
         
         // Redirect to home page
         setTimeout(() => {
           window.location.href = 'index.html';
         }, 2000);
       }
     }
    
         // Retry payment function
     function retryPayment() {
       // Get existing enrollment data
       const enrollmentData = localStorage.getItem('userEnrollment');
       if (!enrollmentData) {
         alert('‚ùå No enrollment data found. Please enroll again.');
         window.location.href = 'index.html';
         return;
       }
       
       try {
         const userData = JSON.parse(enrollmentData);
         
         // Show loading state
         const retryBtn = document.querySelector('button[onclick="retryPayment()"]');
         const originalText = retryBtn.textContent;
         retryBtn.textContent = 'üîÑ Processing...';
         retryBtn.disabled = true;
         
         // Initialize Razorpay payment
         const options = {
           key: 'rzp_live_R9QVhOlTJvswsH',
           amount: 100, // ‚Çπ1 in paise
           currency: 'INR',
           name: 'Caf√© Business Masterclass',
           description: 'Complete Course + 4 Bonuses - Payment Retry',
           image: 'https://your-logo-url.com/logo.png',
           handler: function (response) {
             alert('üéâ Payment Successful! Welcome to the Caf√© Business Masterclass!\n\nPayment ID: ' + response.razorpay_payment_id + '\n\nYou now have full access to all 12 modules and 4 bonuses!\n\nRefreshing dashboard...');
             
             // Update enrollment status
             const updatedEnrollment = {
               ...userData,
               status: 'enrolled',
               paymentId: response.razorpay_payment_id,
               paymentDate: new Date().toISOString(),
               courseAccess: 'full',
               retryCount: (userData.retryCount || 0) + 1
             };
             
             localStorage.setItem('userEnrollment', JSON.stringify(updatedEnrollment));
             
             // Refresh dashboard
             setTimeout(() => {
               window.location.reload();
             }, 2000);
           },
           prefill: {
             email: userData.email || 'user@example.com',
             contact: userData.phone || '9999999999'
           },
           notes: {
             course: 'Caf√© Business Masterclass',
             type: 'main_course',
             retry: 'true'
           },
           theme: {
             color: '#8B5CF6'
           },
           modal: {
             ondismiss: function() {
               // Reset button when modal is dismissed
               retryBtn.textContent = originalText;
               retryBtn.disabled = false;
             }
           }
         };
         
         // Load Razorpay if not already loaded
         if (typeof Razorpay === 'undefined') {
           const script = document.createElement('script');
           script.src = 'https://checkout.razorpay.com/v1/checkout.js';
           script.onload = function() {
             openRazorpayPayment(options);
           };
           script.onerror = function() {
             alert('‚ùå Failed to load payment gateway. Please try again.');
             retryBtn.textContent = originalText;
             retryBtn.disabled = false;
           };
           document.head.appendChild(script);
         } else {
           openRazorpayPayment(options);
         }
         
       } catch (error) {
         console.error('Retry payment error:', error);
         alert('‚ùå Error processing payment retry. Please try again.');
         const retryBtn = document.querySelector('button[onclick="retryPayment()"]');
         retryBtn.textContent = 'üîÑ Retry Payment Now';
         retryBtn.disabled = false;
       }
     }
     
     // Grant manual access for users who have already paid
     function grantManualAccess() {
       const confirmGrant = confirm('üîê Manual Access Grant\n\nAre you sure you have already paid for the course?\n\nThis will grant you full access to all 12 modules and 4 bonuses.\n\nClick OK to confirm, or Cancel to go back.');
       
       if (confirmGrant) {
         // Get existing enrollment data
         const enrollmentData = localStorage.getItem('userEnrollment');
         let userData = {};
         
         if (enrollmentData) {
           try {
             userData = JSON.parse(enrollmentData);
           } catch (error) {
             console.error('Error parsing enrollment data:', error);
           }
         }
         
         // Create or update enrollment with full access
         const updatedEnrollment = {
           name: userData.name || 'abhijjetwankhede',
           email: userData.email || 'yuvapreneur@gmail.com',
           phone: userData.phone || '9999999999',
           status: 'enrolled',
           courseAccess: 'full',
           enrolledAt: userData.enrolledAt || new Date().toISOString(),
           manualAccessGranted: true,
           accessGrantedAt: new Date().toISOString(),
           note: 'Access granted manually - user confirmed payment'
         };
         
         // Store updated enrollment
         localStorage.setItem('userEnrollment', JSON.stringify(updatedEnrollment));
         
         // Show success message
         alert('üéâ Access Granted Successfully!\n\nYou now have full access to:\n‚úÖ All 12 Course Modules\n‚úÖ All 4 Bonus PDFs\n‚úÖ Complete Course Content\n\nRefreshing dashboard...');
         
         // Refresh dashboard to show new access
         setTimeout(() => {
           window.location.reload();
         }, 2000);
       }
     }
     
     // Check and fix enrollment status
     function checkAndFixEnrollmentStatus() {
       const enrollmentData = localStorage.getItem('userEnrollment');
       
       if (enrollmentData) {
         try {
           const userData = JSON.parse(enrollmentData);
           
           // Check if user has payment ID but wrong status
           if (userData.paymentId && userData.status !== 'enrolled') {
             console.log('Found payment ID but wrong status, fixing...');
             
             const fixedEnrollment = {
               ...userData,
               status: 'enrolled',
               courseAccess: 'full',
               fixedAt: new Date().toISOString()
             };
             
             localStorage.setItem('userEnrollment', JSON.stringify(fixedEnrollment));
             
             // Refresh dashboard
             setTimeout(() => {
               window.location.reload();
             }, 1000);
           }
           
           // Show debug section if there are issues
           if (userData.status !== 'enrolled') {
             document.getElementById('debugSection').style.display = 'block';
           }
         } catch (error) {
           console.error('Error checking enrollment status:', error);
           document.getElementById('debugSection').style.display = 'block';
         }
       }
     }
     
     // Clear all enrollment data
     function clearEnrollmentData() {
       const confirmClear = confirm('üóëÔ∏è Clear All Data\n\nThis will remove all your enrollment data and you will need to enroll again.\n\nAre you sure you want to continue?');
       
       if (confirmClear) {
         localStorage.removeItem('userEnrollment');
         localStorage.removeItem('tempUserData');
         localStorage.removeItem('purchasedBonuses');
         
         alert('‚úÖ All data cleared successfully!\n\nRedirecting to home page to enroll again...');
         
         setTimeout(() => {
           window.location.href = 'index.html';
         }, 2000);
       }
     }
     
     // Show current enrollment data
     function showEnrollmentData() {
       const enrollmentData = localStorage.getItem('userEnrollment');
       
       if (enrollmentData) {
         try {
           const userData = JSON.parse(enrollmentData);
           const dataString = JSON.stringify(userData, null, 2);
           
           alert('üìä Current Enrollment Data:\n\n' + dataString);
         } catch (error) {
           alert('‚ùå Error reading enrollment data: ' + error.message);
         }
       } else {
         alert('üìä No enrollment data found in localStorage.');
       }
     }
     
     // Open Razorpay payment
     function openRazorpayPayment(options) {
       try {
         const rzp = new Razorpay(options);
         
         // Add error handling for payment failures
         rzp.on('payment.failed', function (response) {
           console.error('Payment failed:', response.error);
           alert('‚ùå Payment failed: ' + (response.error.description || 'Unknown error') + '\n\nPlease try again or contact support.');
           
           // Mark payment as failed
           const enrollmentData = localStorage.getItem('userEnrollment');
           if (enrollmentData) {
             try {
               const userData = JSON.parse(enrollmentData);
               const failedEnrollment = {
                 ...userData,
                 status: 'payment_failed',
                 failedAt: new Date().toISOString(),
                 failureReason: response.error.description || 'Payment failed'
               };
               localStorage.setItem('userEnrollment', JSON.stringify(failedEnrollment));
             } catch (error) {
               console.error('Error updating failed payment:', error);
             }
           }
           
           // Reset button
           const retryBtn = document.querySelector('button[onclick="retryPayment()"]');
           retryBtn.textContent = 'üîÑ Retry Payment Now';
           retryBtn.disabled = false;
         });
         
         rzp.open();
       } catch (error) {
         console.error('Razorpay error:', error);
         alert('‚ùå Payment failed to open. Please try again.');
         
         // Reset button
         const retryBtn = document.querySelector('button[onclick="retryPayment()"]');
         retryBtn.textContent = 'üîÑ Retry Payment Now';
         retryBtn.disabled = false;
       }
     }
     
     // Check enrollment status and show/hide login link
     function checkEnrollmentStatus() {
       const enrollmentData = localStorage.getItem('userEnrollment');
       const loginLink = document.getElementById('loginLink');
       
       if (enrollmentData) {
         try {
           const userData = JSON.parse(enrollmentData);
           // Show login link if user has any enrollment data (pending, enrolled, or failed)
           if (userData.status) {
             loginLink.classList.remove('hidden');
             console.log('User has enrollment data, showing login link');
           }
         } catch (error) {
           console.error('Error checking enrollment status:', error);
         }
       } else {
         // Hide login link for new users
         loginLink.classList.add('hidden');
         console.log('New user, hiding login link');
       }
     }
  </script>
</body>
</html>
