<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment System Test - Caf√© Business Masterclass</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-8">üß™ Payment System Test</h1>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Test Payment Creation -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-4">üí∞ Test Order Creation</h2>
                <button 
                    id="testOrderBtn"
                    class="w-full bg-blue-500 text-white py-3 px-4 rounded-lg hover:bg-blue-600 transition-colors"
                >
                    Test Create Order
                </button>
                <div id="orderResult" class="mt-4 p-3 bg-gray-100 rounded text-sm hidden"></div>
            </div>

            <!-- Test Authentication Status -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-4">üîê Test Auth Status</h2>
                <button 
                    id="testAuthBtn"
                    class="w-full bg-green-500 text-white py-3 px-4 rounded-lg hover:bg-green-600 transition-colors"
                >
                    Check Auth Status
                </button>
                <div id="authResult" class="mt-4 p-3 bg-gray-100 rounded text-sm hidden"></div>
            </div>

            <!-- Test PDF Access -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-4">üìö Test PDF Access</h2>
                <button 
                    id="testPdfBtn"
                    class="w-full bg-purple-500 text-white py-3 px-4 rounded-lg hover:bg-purple-600 transition-colors"
                >
                    Test PDF List
                </button>
                <div id="pdfResult" class="mt-4 p-3 bg-gray-100 rounded text-sm hidden"></div>
            </div>

            <!-- Test Enrollment -->
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-4">üìù Test Enrollment</h2>
                <button 
                    id="testEnrollBtn"
                    class="w-full bg-orange-500 text-white py-3 px-4 rounded-lg hover:bg-orange-600 transition-colors"
                >
                    Test Enrollment
                </button>
                <div id="enrollResult" class="mt-4 p-3 bg-gray-100 rounded text-sm hidden"></div>
            </div>
        </div>

        <!-- Navigation Links -->
        <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-semibold mb-4">üß≠ Navigation Links</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <a href="/" class="text-blue-600 hover:text-blue-800 text-center p-3 border rounded hover:bg-blue-50">
                    üè† Main Page
                </a>
                <a href="/buy.html" class="text-green-600 hover:text-green-800 text-center p-3 border rounded hover:bg-green-50">
                    üí≥ Payment Page
                </a>
                <a href="/login.html" class="text-orange-600 hover:text-orange-800 text-center p-3 border rounded hover:bg-orange-50">
                    üîë Login Page
                </a>
                <a href="/dashboard.html" class="text-purple-600 hover:text-purple-800 text-center p-3 border rounded hover:bg-purple-50">
                    üìä Dashboard
                </a>
            </div>
        </div>

        <!-- Status Summary -->
        <div class="mt-8 bg-white p-6 rounded-lg shadow-md">
            <h2 class="text-xl font-semibold mb-4">üìä System Status</h2>
            <div id="systemStatus" class="space-y-2">
                <div class="flex items-center">
                    <span class="w-3 h-3 bg-gray-400 rounded-full mr-3"></span>
                    <span>Checking system status...</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Test Order Creation
        document.getElementById('testOrderBtn').addEventListener('click', async () => {
            const resultDiv = document.getElementById('orderResult');
            resultDiv.innerHTML = 'Testing...';
            resultDiv.classList.remove('hidden');
            
            try {
                const response = await fetch('/create-order', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ amount: 1, currency: 'INR' })
                });
                
                const data = await response.json();
                resultDiv.innerHTML = `<strong>Status:</strong> ${response.status}<br><strong>Response:</strong> ${JSON.stringify(data, null, 2)}`;
                resultDiv.className = response.ok ? 'mt-4 p-3 bg-green-100 rounded text-sm' : 'mt-4 p-3 bg-red-100 rounded text-sm';
            } catch (error) {
                resultDiv.innerHTML = `<strong>Error:</strong> ${error.message}`;
                resultDiv.className = 'mt-4 p-3 bg-red-100 rounded text-sm';
            }
        });

        // Test Auth Status
        document.getElementById('testAuthBtn').addEventListener('click', async () => {
            const resultDiv = document.getElementById('authResult');
            resultDiv.innerHTML = 'Testing...';
            resultDiv.classList.remove('hidden');
            
            try {
                const response = await fetch('/auth-status');
                const data = await response.json();
                resultDiv.innerHTML = `<strong>Status:</strong> ${response.status}<br><strong>Response:</strong> ${JSON.stringify(data, null, 2)}`;
                resultDiv.className = response.ok ? 'mt-4 p-3 bg-green-100 rounded text-sm' : 'mt-4 p-3 bg-red-100 rounded text-sm';
            } catch (error) {
                resultDiv.innerHTML = `<strong>Error:</strong> ${error.message}`;
                resultDiv.className = 'mt-4 p-3 bg-red-100 rounded text-sm';
            }
        });

        // Test PDF Access
        document.getElementById('testPdfBtn').addEventListener('click', async () => {
            const resultDiv = document.getElementById('pdfResult');
            resultDiv.innerHTML = 'Testing...';
            resultDiv.classList.remove('hidden');
            
            try {
                const response = await fetch('/pdfs');
                if (response.status === 401) {
                    resultDiv.innerHTML = '<strong>Status:</strong> 401 Unauthorized (Expected - PDFs are protected)<br><strong>Message:</strong> Authentication required';
                    resultDiv.className = 'mt-4 p-3 bg-yellow-100 rounded text-sm';
                } else {
                    const data = await response.json();
                    resultDiv.innerHTML = `<strong>Status:</strong> ${response.status}<br><strong>Response:</strong> ${JSON.stringify(data, null, 2)}`;
                    resultDiv.className = response.ok ? 'mt-4 p-3 bg-green-100 rounded text-sm' : 'mt-4 p-3 bg-red-100 rounded text-sm';
                }
            } catch (error) {
                resultDiv.innerHTML = `<strong>Error:</strong> ${error.message}`;
                resultDiv.className = 'mt-4 p-3 bg-red-100 rounded text-sm';
            }
        });

        // Test Enrollment
        document.getElementById('testEnrollBtn').addEventListener('click', async () => {
            const resultDiv = document.getElementById('enrollResult');
            resultDiv.innerHTML = 'Testing...';
            resultDiv.classList.remove('hidden');
            
            try {
                const response = await fetch('/users', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: 'Test User',
                        phone: '1234567890',
                        email: 'test@example.com',
                        password: 'testpass123'
                    })
                });
                
                const data = await response.json();
                resultDiv.innerHTML = `<strong>Status:</strong> ${response.status}<br><strong>Response:</strong> ${JSON.stringify(data, null, 2)}`;
                resultDiv.className = response.ok ? 'mt-4 p-3 bg-green-100 rounded text-sm' : 'mt-4 p-3 bg-red-100 rounded text-sm';
            } catch (error) {
                resultDiv.innerHTML = `<strong>Error:</strong> ${error.message}`;
                resultDiv.className = 'mt-4 p-3 bg-red-100 rounded text-sm';
            }
        });

        // Check System Status
        async function checkSystemStatus() {
            const statusDiv = document.getElementById('systemStatus');
            const checks = [
                { name: 'Main Page', url: '/', expected: 200 },
                { name: 'Payment Page', url: '/buy.html', expected: 200 },
                { name: 'Login Page', url: '/login.html', expected: 200 },
                { name: 'Dashboard Page', url: '/dashboard.html', expected: 200 },
                { name: 'Auth Status API', url: '/auth-status', expected: 200 },
                { name: 'Create Order API', url: '/create-order', expected: 405 }, // Method not allowed for GET
                { name: 'PDFs List API', url: '/pdfs', expected: 401 } // Unauthorized without auth
            ];

            let html = '';
            for (const check of checks) {
                try {
                    const response = await fetch(check.url, { method: 'GET' });
                    const isSuccess = response.status === check.expected;
                    const color = isSuccess ? 'bg-green-400' : 'bg-yellow-400';
                    const text = isSuccess ? '‚úì' : '‚ö†';
                    
                    html += `<div class="flex items-center">
                        <span class="w-3 h-3 ${color} rounded-full mr-3">${text}</span>
                        <span>${check.name}: ${response.status} ${isSuccess ? '(Expected)' : '(Unexpected)'}</span>
                    </div>`;
                } catch (error) {
                    html += `<div class="flex items-center">
                        <span class="w-3 h-3 bg-red-400 rounded-full mr-3">‚úó</span>
                        <span>${check.name}: Error - ${error.message}</span>
                    </div>`;
                }
            }
            
            statusDiv.innerHTML = html;
        }

        // Run system check on page load
        checkSystemStatus();
    </script>
</body>
</html>
